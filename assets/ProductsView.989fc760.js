import{_ as R,N as S,r as N,j as T,Q as u,R as r,S as a,U as o,W as s,a0 as w,as as h,am as W,at as X,$ as P,a3 as Z,X as I,a4 as C,Z as f,a7 as d,a5 as q,a6 as G}from"./index.ecbdd361.js";import{_ as H}from"./Switch.e1ef1893.js";import{_ as J,a as K,b as O}from"./InputNumber.35b6d971.js";import{_ as Y}from"./Modal.f2645210.js";import{_ as ee}from"./Space.c8d1c1cd.js";import{_ as te}from"./Upload.249e99ea.js";import{_ as ne}from"./FormItem.4301471f.js";import{a as oe,_ as le}from"./Form.4032c107.js";import{_ as se}from"./Divider.d4dd732c.js";import{_ as ae}from"./Table.f42846fa.js";import"./utils.a1ce8220.js";import"./Card.3b69db10.js";const ie=g=>(q("data-v-f4185669"),g=g(),G(),g),_e={class:"wrap"},ue={class:"container"},re=d(" \u65B0\u589E\u5546\u54C1 "),de=d(" \u9EDE\u64CA\u4E0A\u50B3 "),pe=d("\u662F\u5426\u4E0A\u67B6 "),ce=d(" \u78BA\u8A8D "),me=ie(()=>a("thead",null,[a("tr",null,[a("th",null,"\u5716\u7247"),a("th",null,"\u540D\u7A31"),a("th",null,"\u50F9\u683C"),a("th",null,"\u63CF\u8FF0"),a("th",null,"\u7DE8\u8F2F"),a("th",null,"\u522A\u9664")])],-1)),fe=["src"],ge={key:0},ve=d(" \u7DE8\u8F2F "),be={key:1},he=d(" \u7DE8\u8F2F "),ye={key:2},ke=d(" \u522A\u9664 "),we={key:3},Ce=d(" \u522A\u9664 "),$e={__name:"ProductsView",setup(g){const i=S([]),v=N(!1),_=N(1),c=5,$=T(()=>i.slice(_.value*c-c,_.value*c)),x=[{label:"\u8089\u6842\u6372",value:"\u8089\u6842\u6372"},{label:"\u63D0\u62C9\u7C73\u8607",value:"\u63D0\u62C9\u7C73\u8607"},{label:"\u5B63\u7BC0\u9650\u5B9A",value:"\u5B63\u7BC0\u9650\u5B9A"}],t=S({_id:"",name:"",price:0,category:"",sell:!1,image:[],description:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),y=(l,e)=>{v.value=!0,t._id=l,e>-1?(t.name=i[e].name,t.price=i[e].price,t.description=i[e].description,t.sell=i[e].sell,t.category=i[e].category):(t.name="",t.price=0,t.description="",t.sell=!1,t.category=""),t.image=[],t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},A=async()=>{t.submitting=!0;const l=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||(e==="image"?t.image.length>0&&l.append(e,t[e][0].file):l.append(e,t[e]));try{if(t._id.length===0){const{data:e}=await w.post("/products",l);i.push(e.result),h.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await w.patch("/products/"+t._id,l);i[t.idx]=e.result,h.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){h.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1};return(async()=>{try{const{data:l}=await w.get("/products/all");i.push(...l.result)}catch(l){console.log(l),h.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}})(),(l,e)=>{const p=W,B=te,m=ne,U=oe,D=K,E=H,F=O,M=le,z=Y,V=se,j=ae,L=ee,Q=J;return u(),r("div",_e,[a("div",ue,[o(p,{color:"#ffcb98",onClick:e[0]||(e[0]=n=>y("",-1))},{default:s(()=>[re]),_:1}),o(z,{show:v.value,"onUpdate:show":e[9]||(e[9]=n=>v.value=n),preset:"dialog",title:"\u65B0\u589E\u5546\u54C1"},{default:s(()=>[o(M,{modelValue:t.valid,"onUpdate:modelValue":e[8]||(e[8]=n=>t.valid=n),onSubmit:X(A,["prevent"])},{default:s(()=>[o(m,{label:"\u5716\u7247"},{default:s(()=>[o(B,{"file-list":t.image,"onUpdate:file-list":e[1]||(e[1]=n=>t.image=n),"list-type":"image-card"},{default:s(()=>[o(p,null,{default:s(()=>[de]),_:1})]),_:1},8,["file-list"])]),_:1}),o(m,{label:"name"},{default:s(()=>[o(U,{value:t.name,"onUpdate:value":e[2]||(e[2]=n=>t.name=n)},null,8,["value"])]),_:1}),o(m,{label:"price"},{default:s(()=>[o(D,{value:t.price,"onUpdate:value":e[3]||(e[3]=n=>t.price=n)},null,8,["value"])]),_:1}),o(m,{label:"description"},{default:s(()=>[o(U,{value:t.description,"onUpdate:value":e[4]||(e[4]=n=>t.description=n),type:"textarea"},null,8,["value"])]),_:1}),o(m,{label:"sell"},{default:s(()=>[o(E,{value:t.sell,"onUpdate:value":e[5]||(e[5]=n=>t.sell=n)},null,8,["value"]),pe]),_:1}),o(F,{value:t.category,"onUpdate:value":e[6]||(e[6]=n=>t.category=n),options:x},null,8,["value"]),o(p,{color:"#ffcb98","attr-type":"submit",onClick:e[7]||(e[7]=n=>v.value=!1)},{default:s(()=>[ce]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["show"]),o(V),a("div",null,[o(L,{vertical:""},{default:s(()=>[o(j,{striped:""},{default:s(()=>[me,a("tbody",null,[(u(!0),r(P,null,Z(I($),(n,b)=>(u(),r(P,null,[I($).length>0?(u(),r("tr",{key:n._id},[a("td",null,[a("img",{style:{height:"150px"},src:n.image},null,8,fe)]),a("td",null,C(n.name),1),a("td",null,C(n.price),1),a("td",null,C(n.description),1),_.value===1?(u(),r("td",ge,[o(p,{color:"#ffcb98",onClick:k=>y(n._id,b),loading:l.loading},{default:s(()=>[ve]),_:2},1032,["onClick","loading"])])):f("",!0),_.value>1?(u(),r("td",be,[o(p,{color:"#ffcb98",onClick:k=>y(n._id,b+(_.value-1)*c),loading:l.loading},{default:s(()=>[he]),_:2},1032,["onClick","loading"])])):f("",!0),_.value===1?(u(),r("td",ye,[o(p,{color:"#ffcb98",onClick:k=>l.del(n._id,b),loading:l.loading},{default:s(()=>[ke]),_:2},1032,["onClick","loading"])])):f("",!0),_.value>1?(u(),r("td",we,[o(p,{color:"#ffcb98",onClick:k=>l.del(n._id,b+(_.value-1)*c),loading:l.loading},{default:s(()=>[Ce]),_:2},1032,["onClick","loading"])])):f("",!0)])):f("",!0)],64))),256))])]),_:1})]),_:1})]),o(V),o(Q,{page:_.value,"onUpdate:page":e[10]||(e[10]=n=>_.value=n),"page-count":Math.ceil(i.length/c),style:{float:"right"},"default-page-size":6},null,8,["page","page-count"])])])}}},ze=R($e,[["__scopeId","data-v-f4185669"]]);export{ze as default};
