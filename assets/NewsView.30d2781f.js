import{_ as I,N as h,r as D,Q as d,R as p,S as s,U as n,W as l,a0 as g,aA as c,am as E,$ as x,a3 as F,a4 as y,Z as z,aB as M,a5 as L,a6 as Q,a7 as m}from"./index.4ae3d2fe.js";import{_ as R}from"./Upload.f5a42611.js";import{_ as T}from"./Space.138daf33.js";import{_ as W}from"./Modal.df6f1388.js";import{_ as Z}from"./Divider.57646a35.js";import{_ as j}from"./Avatar.a3ed534f.js";import{_ as q}from"./Table.f1879f8b.js";import{_ as G}from"./FormItem.09d843a3.js";import{_ as H}from"./Input.6be93c33.js";import{_ as J}from"./Form.87cab9f2.js";import"./utils.12d16166.js";import"./Card.5afde179.js";const V=_=>(L("data-v-5812eb06"),_=_(),Q(),_),K={class:"wrap"},O={class:"container"},P=m(" \u65B0\u589E\u6700\u65B0\u6D88\u606F "),X=V(()=>s("h1",null,"\u6700\u65B0\u6D88\u606F\u7BA1\u7406",-1)),Y=V(()=>s("thead",null,[s("tr",null,[s("th",null,"\u5716\u7247"),s("th",null,"\u6A19\u984C"),s("th",null,"\u63CF\u8FF0"),s("th",null,"\u7DE8\u8F2F")])],-1)),tt={style:{"white-space":"pre"}},et=m(" \u7DE8\u8F2F "),ot=m("\u9EDE\u64CA\u4E0A\u50B3"),nt=m(" \u78BA\u8A8D "),st={__name:"NewsView",setup(_){const a=h([]),r=D(!1),e=h({_id:"",title:"",image:[],description:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),v=(i,t)=>{r.value=!0,e._id=i,t>-1?(e.title=a[t].title,e.description=a[t].description):(e.title="",e.description=""),e.image=[],e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},k=async()=>{e.submitting=!0;const i=new FormData;for(const t in e)["_id","idx","dialog","valid","submitting"].includes(t)||(t==="image"?e.image.length>0&&i.append(t,e[t][0].file):i.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await g.post("/news",i);a.push(t.result),c.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await g.patch("/news/"+e._id,i);a[e.idx]=t.result,c.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(t){c.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1};return(async()=>{try{const{data:i}=await g.get("/news");a.push(...i.result)}catch(i){console.log(i),c.fire({icon:"error",title:"\u5931\u6557",text:i.isAxiosError?i.response.data.message:i.message})}})(),(i,t)=>{const u=E,w=Z,N=j,S=q,$=T,C=R,f=G,b=H,U=J,A=W;return d(),p("div",K,[s("div",O,[n(u,{color:"#ffcb98",onClick:t[0]||(t[0]=o=>v("",-1))},{default:l(()=>[P]),_:1}),n(w),X,s("div",null,[n($,{vertical:""},{default:l(()=>[n(S,{striped:""},{default:l(()=>[Y,s("tbody",null,[(d(!0),p(x,null,F(a,(o,B)=>(d(),p(x,null,[a.length>0?(d(),p("tr",{key:o._id},[s("td",null,[n(N,{size:48,src:o.image},null,8,["src"])]),s("td",null,y(o.title),1),s("td",tt,y(o.description),1),s("td",null,[n(u,{color:"#ffcb98",onClick:lt=>v(o._id,B)},{default:l(()=>[et]),_:2},1032,["onClick"])])])):z("",!0)],64))),256))])]),_:1})]),_:1})]),s("div",null,[n(A,{show:r.value,"onUpdate:show":t[6]||(t[6]=o=>r.value=o),preset:"dialog",color:"#ffcb98",title:"\u65B0\u589E\u6700\u65B0\u6D88\u606F"},{default:l(()=>[n(U,{modelValue:e.valid,"onUpdate:modelValue":t[5]||(t[5]=o=>e.valid=o),onSubmit:M(k,["prevent"])},{default:l(()=>[n(f,{label:"\u5716\u7247"},{default:l(()=>[n(C,{"file-list":e.image,"onUpdate:file-list":t[1]||(t[1]=o=>e.image=o),"list-type":"image-card"},{default:l(()=>[n(u,null,{default:l(()=>[ot]),_:1})]),_:1},8,["file-list"])]),_:1}),n(f,{label:"\u6700\u65B0\u6D88\u606F\u6A19\u984C"},{default:l(()=>[n(b,{value:e.title,"onUpdate:value":t[2]||(t[2]=o=>e.title=o),placeholder:"\u8ACB\u8F38\u5165\u6A19\u984C"},null,8,["value"])]),_:1}),n(f,{label:"\u5167\u5BB9"},{default:l(()=>[n(b,{type:"textarea",autosize:"",value:e.description,"onUpdate:value":t[3]||(t[3]=o=>e.description=o),placeholder:"\u8ACB\u8F38\u5165\u63CF\u8FF0"},null,8,["value"])]),_:1}),n(u,{color:"#ffcb98","attr-type":"submit",onClick:t[4]||(t[4]=o=>r.value=!1)},{default:l(()=>[nt]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["show"]),n(w)])])])}}},bt=I(st,[["__scopeId","data-v-5812eb06"]]);export{bt as default};
